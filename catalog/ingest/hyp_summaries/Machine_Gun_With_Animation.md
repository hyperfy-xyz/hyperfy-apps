# Machine_Gun_With_Animation.hyp

## Metadata
- **Author**: Saori
- **Channel**: #ðŸŽ¨â”‚showcase
- **Date**: 2025-03-12
- **Size**: 2,383,754 bytes

## Blueprint
- **Name**: Weapon Animation Override
- **Version**: 64
- **Model**: `asset://bd64571a893b313fb9e3a7a89b5e9be04f61b09e99b7a724ae224a53d815b069.glb`
- **Script**: `asset://81848cdb343c25defd67d6298f7030b5556ca00265addb3b0498d4f53edcf9fc.js`

## Props
- `walkAim`: emote â†’ `asset://809db322bcf5ccb00933db8e3e54a5bcb5537f9c12fa94cf3d3e6085eb733b66.glb`
- `idle`: emote â†’ `asset://485623dd20a3d7eb85434fdeba53a7169e720b2cd3eee1451e89e1eb6763e353.glb`
- `walk`: emote â†’ `asset://c8b956774ac7afcd18c4ffe4921fb46a77370c32465f9dc5e2935e76b997ad2a.glb`
- `run`: emote â†’ `asset://809db322bcf5ccb00933db8e3e54a5bcb5537f9c12fa94cf3d3e6085eb733b66.glb`
- `walkBack`: emote â†’ `asset://3f25cdec89613a6bd577ffe5bb2ead3ba467f53678ba7e3523c79a4764092328.glb`
- `walkLeft`: emote â†’ `asset://7a0507f3183817e60c0d906966838d1683208f19fa82f9670c39d4a845f87b37.glb`
- `walkRight`: emote â†’ `asset://3c238a8e7946dab8dfc84fd33d6ed9b0858eaf8a25760fa3abdd97e8eab2d707.glb`
- `walkBackLeft`: emote â†’ `asset://13f25229e190705f3cb31e7c3197c6bb14cdbeb4ab5fddb2ebfb06b44d022e1f.glb`
- `walkBackRight`: emote â†’ `asset://5e07ff4cf6c529d20710b8f674b43742bf98b4416262ae40672492bbc7ec61ee.glb`
- `sprintBackright`: emote â†’ `asset://54ea4fb02dfcea6977208ad46f6b41d86f72096a70a8b0b109b811acccbed4a7.glb`
- `sprintBackRight`: emote â†’ `asset://54ea4fb02dfcea6977208ad46f6b41d86f72096a70a8b0b109b811acccbed4a7.glb`
- `sprintBackLeft`: emote â†’ `asset://265a8b00248f2e8236f9bfd600f80bb3ecb1c07eb7740c3be07e062e8769621b.glb`
- `walkForwardLeft`: emote â†’ `asset://53ae8ceaed1941b8201257a9cc1dd5df5793c15cde3346bb208c98555eb6df84.glb`
- `walkForwardRight`: emote â†’ `asset://73743909f5a9a886cd5ad9aa964b6c9e90d0fb13d3c381e125a2d54cb83e5ee3.glb`
- `sprintForwardRight`: emote â†’ `asset://f154ac4c8e88f146d69c67816be0e169635c4760c8b6c3833ff5a7823e9fdee0.glb`
- `sprintForwardLeft`: emote â†’ `asset://20b023820e2aacbfdbde243461d05a776b78b6a24a4cd3dbe98df950f3bbb724.glb`
- `sprintBackward`: emote â†’ `asset://64ce7a7cac1d6b8b390d1b7731dafbdcfa004bb2c916349dd674196a119e51ce.glb`
- `sprintLeft`: emote â†’ `asset://046594ab0e939004aa1230f1ceaa2700fd058b226b7d833492a43346a2109d78.glb`
- `sprintRight`: emote â†’ `asset://79b2b1ecb3283926154521dbfbc9ee6c06a364acbd00bc1de59fd3fefa8ba34b.glb`

## Assets
- `[model]` bd64571a893b313fb9e3a7a89b5e9be04f61b09e99b7a724ae224a53d815b069.glb (732,000 bytes)
- `[script]` 81848cdb343c25defd67d6298f7030b5556ca00265addb3b0498d4f53edcf9fc.js (4,649 bytes)
- `[texture]` e8d7222b9ba922872c317fd2c9a2693f4ab4b986f8c5eae39c19925c230ee797.png (115,029 bytes)
- `[emote]` 809db322bcf5ccb00933db8e3e54a5bcb5537f9c12fa94cf3d3e6085eb733b66.glb (74,236 bytes)
- `[emote]` 485623dd20a3d7eb85434fdeba53a7169e720b2cd3eee1451e89e1eb6763e353.glb (141,144 bytes)
- `[emote]` c8b956774ac7afcd18c4ffe4921fb46a77370c32465f9dc5e2935e76b997ad2a.glb (83,212 bytes)
- `[emote]` 809db322bcf5ccb00933db8e3e54a5bcb5537f9c12fa94cf3d3e6085eb733b66.glb (74,236 bytes)
- `[emote]` 3f25cdec89613a6bd577ffe5bb2ead3ba467f53678ba7e3523c79a4764092328.glb (79,844 bytes)
- `[emote]` 7a0507f3183817e60c0d906966838d1683208f19fa82f9670c39d4a845f87b37.glb (79,836 bytes)
- `[emote]` 3c238a8e7946dab8dfc84fd33d6ed9b0858eaf8a25760fa3abdd97e8eab2d707.glb (79,856 bytes)
- `[emote]` 13f25229e190705f3cb31e7c3197c6bb14cdbeb4ab5fddb2ebfb06b44d022e1f.glb (79,832 bytes)
- `[emote]` 5e07ff4cf6c529d20710b8f674b43742bf98b4416262ae40672492bbc7ec61ee.glb (79,852 bytes)
- `[emote]` 54ea4fb02dfcea6977208ad46f6b41d86f72096a70a8b0b109b811acccbed4a7.glb (74,244 bytes)
- `[emote]` 54ea4fb02dfcea6977208ad46f6b41d86f72096a70a8b0b109b811acccbed4a7.glb (74,244 bytes)
- `[emote]` 265a8b00248f2e8236f9bfd600f80bb3ecb1c07eb7740c3be07e062e8769621b.glb (74,228 bytes)
- `[emote]` 53ae8ceaed1941b8201257a9cc1dd5df5793c15cde3346bb208c98555eb6df84.glb (79,848 bytes)
- `[emote]` 73743909f5a9a886cd5ad9aa964b6c9e90d0fb13d3c381e125a2d54cb83e5ee3.glb (79,832 bytes)
- `[emote]` f154ac4c8e88f146d69c67816be0e169635c4760c8b6c3833ff5a7823e9fdee0.glb (74,232 bytes)
- `[emote]` 20b023820e2aacbfdbde243461d05a776b78b6a24a4cd3dbe98df950f3bbb724.glb (74,232 bytes)
- `[emote]` 64ce7a7cac1d6b8b390d1b7731dafbdcfa004bb2c916349dd674196a119e51ce.glb (74,248 bytes)
- `[emote]` 046594ab0e939004aa1230f1ceaa2700fd058b226b7d833492a43346a2109d78.glb (74,252 bytes)
- `[emote]` 79b2b1ecb3283926154521dbfbc9ee6c06a364acbd00bc1de59fd3fefa8ba34b.glb (74,240 bytes)

## Script Analysis
**App Methods**: `app.add()`, `app.configure()`, `app.control()`, `app.create()`, `app.emit()`, `app.on()`, `app.send()`
**World Methods**: `world.getPlayer()`
**Events Listened**: `dropped`, `lateUpdate`, `shoot`, `taken`, `update`
**Events Emitted**: `shoot`
**Nodes Created**: `action`

## Keywords (for Discord search)
action, active, animation, animationConfig, animationState, animations, applyEffect, applyQuaternion, backward, bonePosition, camDirection, camPos, camQuat, camera, cancel, configure, control, controls, copy, create

## Script Source
```javascript
const animations = [
  'idle',
  'run',
  'walk',
  'walkBack',
  'walkLeft',
  'walkRight',
  'sprintLeft',
  'sprintRight',
  'walkBackLeft',
  'walkBackRight',
  'sprintBackRight',
  'sprintBackLeft',
  'walkForwardLeft',
  'walkForwardRight',
  'sprintForwardRight',
  'sprintForwardLeft',
  'sprintBackward'
];

const animationConfig = animations.map(animation => {
  const label = animation
    .replace(/([A-Z])/g, ' $1')
    .replace(/^./, str => str.toUpperCase());
  return {
    key: animation,
    type: 'file',
    kind: 'emote',
    label: `${label} Animation`
  };
});

app.configure(animationConfig);

if (world.isClient) {
  const forwardVec = new Vector3(0, 0, -1)
  let currentEffect = undefined
  let holder = undefined
  if (holder === undefined && app.state.owner !== undefined) {
    holder = world.getPlayer(app.state.owner)
  }
  const { id: localId } = world.getPlayer()
  const controls = app.control()
  const action = app.create('action', {
    label: 'Pick Up',
    distance: 3,
    onTrigger: ({ playerId }) => {
      action.active = false;
      app.send('taken', playerId)
      holder = world.getPlayer(playerId)
    }
  });
  if (holder !== undefined) action.active = false

  app.on('taken', (playerId) => {
    holder = world.getPlayer(playerId)
    action.active = false
  })

  app.on('dropped', () => {
    holder = undefined
    action.active = true
  })

  controls.keyX.onRelease = () => {
    if (holder === undefined) return
    if (holder.id !== localId) return

    app.send('dropped', localId)

    holder = undefined
    currentEffect.cancel()
    action.active = true
  }

  app.add(action)

  const FIRE_RATE = 0.1;
  let shootCooldown = 0;
  let animationState = 'idle';

  app.on('update', (delta) => {
    if (!holder?.id || localId !== holder?.id) return;

    if (shootCooldown > 0) {
      shootCooldown -= delta;
    }

    const {
      keyW,
      keyA,
      keyS,
      keyD,
      shiftLeft,
      mouseLeft,
      mouseRight
    } = controls;

    const forward = keyW.down;
    const backward = keyS.down;
    const left = keyA.down;
    const right = keyD.down;
    const isRunning = shiftLeft.down;
    const shoot = mouseLeft.down;
    const scope = mouseRight.down;

    let newAnimationState = 'idle';

    if (forward && left) {
      newAnimationState = isRunning ? 'sprintForwardLeft' : 'walkForwardLeft';
    } else if (forward && right) {
      newAnimationState = isRunning ? 'sprintForwardRight' : 'walkForwardRight';
    } else if (backward && left) {
      newAnimationState = isRunning ? 'sprintBackLeft' : 'walkBackLeft';
    } else if (backward && right) {
      newAnimationState = isRunning ? 'sprintBackRight' : 'walkBackRight';
    }
    else if (forward) {
      newAnimationState = isRunning ? 'run' : 'walk';
    } else if (backward) {
      newAnimationState = isRunning ? 'sprintBackward' : 'walkBack';
    } else if (left) {
      newAnimationState = isRunning ? 'sprintLeft' : 'walkLeft';
    } else if (right) {
      newAnimationState = isRunning ? 'sprintRight' : 'walkRight';
    }
    if (shoot && shootCooldown <= 0 && !isRunning) {
      onShoot();
      shootCooldown = FIRE_RATE;
    }

    if (scope) {
      onScope();
    }

    if (newAnimationState !== animationState) {
      animationState = newAnimationState;

      currentEffect = holder.applyEffect({
        emote: props[animationState].url,
        turn: true
      });
    }
  });
  const onShoot = () => {
    const { quaternion: camQuat, position: camPos } = controls.camera;
    const camDirection = new Vector3().copy(forwardVec).applyQuaternion(camQuat);
    app.send('shoot', {
      bonePosition: camPos.toArray(),
      camDirection: camDirection.toArray(),
    });
  }

  const onScope = () => {

  }

  app.on('lateUpdate', () => {
    if (holder === undefined) return

    const matrix = holder.getBoneTransform('rightIndexProximal')
    if (matrix) {
      app.position.setFromMatrixPosition(matrix)
      app.quaternion.setFromRotationMatrix(matrix)
    }
  })
}

if (world.isServer) {
  const state = app.state
  app.on('taken', (playerId) => {
    state.owner = playerId
    app.send('taken', playerId, playerId)
  })
  app.on('dropped', (playerId) => {
    state.owner = undefined
    app.send('dropped', undefined, playerId)
  })
  app.on('shoot', ({ camDirection, bonePosition }) => {
    app.emit('shoot', {
      direction: camDirection,
      origin: bonePosition
    })
  })
}
```

---
*Extracted from Machine_Gun_With_Animation.hyp. Attachment ID: 1349513227486105630*