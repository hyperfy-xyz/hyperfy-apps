{"script_excerpt":"const DEBUG = true;\nconst log = (...args) => DEBUG && console.log(...args);\n\nconst DEFAULT_AMOUNT = 5;\n// const TOKEN = \"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v\" //USDC\nconst TOKEN = \"8vBMibwpn8wpfYKbQ9xqzodymg3LjmYec2tSNGRy23K8\"; // HYPER\n// const decimals = 6;\nlet SERVER_WALLET;\n\nlet mode;\nconst setMode = (fn) => {\n  log('Setting mode:', fn.name);\n  mode?.();\n  mode = fn();\n};\n\nif (world.isServer) {\n  log('Server initialized');\n  const players = new Map(); //nid<{pid, wallet, balance}>\n\n  async function getServerBalance() {\n    log('Fetching server balance');\n    if (!app.solana?.connection) {\n      log('No Solana connection for server balance');\n      return null;\n    }\n    // const { token } = app.solana.programs;\n    try {\n      const token = await app.solana.programs.token(TOKEN)\n      const balance = await token.balance(app.solana.wallet.publicKey);\n      log('Server balance fetched:', balance);\n      app.send(\"server:wallet\", {\n        serverWallet: app.solana.wallet.publicKey,\n        serverBalance: balance.balance || 0,\n        decimals: token.decimals,\n        supply: token.supply,\n        name: token.name,\n        symbol: token.symbol,\n        uri: token.uri,\n      });\n      return { balance, decimals: token };\n    } catch (error) {\n      console.error(\"Failed to fetch server balance:\", error);\n      return null;\n    }\n  }\n\n  // Helper function to find network ID by player ID or wallet\n  function findPlayerNid(identifier) {\n    for (const [nid, data] of players.entries()) {\n      if (data.pid === identifier || data.wallet.toString() === identifier.toString()) {\n        return nid;\n      }\n    }\n    return null;\n  }\n\n  function updatePlayerBalance(nid, newBalance) {\n    const player = players.get(nid);\n    if (player) {\n      player.balance = newBalance;\n      app.sendTo(nid, \"server:balance:update\", newBalance);\n      log('Updated balance for player:', { nid, newBalance });\n    }\n  }\n\n  // app.emit(\"token:increment_balance_nid\", collector)\n  world.o","script_path":"assets/c671ccf6763f99592561065f656149944682dd900a40a7eaf678f5c248259a26.js","source_files":[{"path":"assets/bd974ace7906976fc46b15a392989f62aee95a3ffbd3763ebf6ecaa0a24511c2.glb","size_bytes":88424},{"path":"assets/c671ccf6763f99592561065f656149944682dd900a40a7eaf678f5c248259a26.js","size_bytes":16757},{"path":"assets/d60648b9091c00e460545dce3cef7b88c0d643d0a864424f715a878c2ad3661a.png","size_bytes":73989},{"path":"blueprint.json","size_bytes":751},{"path":"manifest.json","size_bytes":780}],"props":{"idleEmote":null,"walkEmote":null,"runEmote":null,"shootEmote":null,"loadingEmote":null},"asset_files":["bd974ace7906976fc46b15a392989f62aee95a3ffbd3763ebf6ecaa0a24511c2.glb","c671ccf6763f99592561065f656149944682dd900a40a7eaf678f5c248259a26.js","d60648b9091c00e460545dce3cef7b88c0d643d0a864424f715a878c2ad3661a.png"],"blueprint_path":"blueprint.json"}