{"script_excerpt":"\n\nconst initialPosition = app.position.toArray()\nconst initialQuaternion = app.quaternion.toArray()\n\nif (world.isClient) {\n  let control\n  const player = world.getPlayer()\n  const action = app.create('action', {\n    active: false,\n    label: 'Equip',\n    onTrigger: e => {\n      action.active = false\n      \n      app.send('request', player.entityId)\n    },\n  })\n  app.add(action)\n  const state = app.state\n  if (!state.playerId) {\n    action.active = true\n  }\n  app.on('playerId', playerId => {\n    state.playerId = playerId\n    action.active = !playerId\n    if (player.entityId === playerId) {\n      control = app.control()\n    } else {\n      control?.release()\n      control = null\n    }\n    if (!playerId) {\n      app.position.fromArray(initialPosition)\n      app.quaternion.fromArray(initialQuaternion)\n    }\n  })\n  app.on('lateUpdate', delta => {\n    if (!state.playerId) return\n    const player = world.getPlayer(state.playerId)\n    const matrix = player.getBoneTransform('rightHand')\n    if (matrix) {\n      app.position.setFromMatrixPosition(matrix)\n      app.quaternion.setFromRotationMatrix(matrix)\n    }\n    if (control?.keyQ.pressed) {\n      app.send('release', player.entityId)\n    }\n  })\n}\n\nif (world.isServer) {\n  const state = app.state\n  state.playerId = null\n  app.on('request', playerId => {\n    if (state.playerId) return\n    state.playerId = playerId\n    app.send('playerId', playerId)\n  })\n  app.on('release', playerId => {\n    console.log(state.playerId, playerId)\n    if (state.playerId !== playerId) return\n    state.playerId = null\n    app.send('playerId', null)\n  })\n  world.on('leave', e => {\n    if (state.playerId === e.player.entityId) {\n      state.playerId = null\n      app.send('playerId', null)\n    }\n  })\n}","script_path":"assets/7f99758800fc7d7dc304320a7d8b53cb0d09c3e2dc5b85084005894aa7adfe3c.js","source_files":[{"path":"assets/39f472b2ec76836a0187c27e3872bf7ba6690fd25b61e6323ca272a44fff3f94.glb","size_bytes":297368},{"path":"assets/7f99758800fc7d7dc304320a7d8b53cb0d09c3e2dc5b85084005894aa7adfe3c.js","size_bytes":1743},{"path":"assets/9eed8f2520fae4b02052fa66264aec8b8ca285bc004267a5a13f6576d40c22ed.glb","size_bytes":60912},{"path":"blueprint.json","size_bytes":965},{"path":"manifest.json","size_bytes":1306}],"props":{"attack":{"type":"emote","name":"emote-sword-out-slash.glb","url":"asset://9eed8f2520fae4b02052fa66264aec8b8ca285bc004267a5a13f6576d40c22ed.glb"},"attack1":{"type":"emote","name":"emote-sword-out-slash.glb","url":"asset://9eed8f2520fae4b02052fa66264aec8b8ca285bc004267a5a13f6576d40c22ed.glb"},"attack2":{"type":"emote","name":"sword-in-slash.glb","url":"asset://9eed8f2520fae4b02052fa66264aec8b8ca285bc004267a5a13f6576d40c22ed.glb"}},"asset_files":["39f472b2ec76836a0187c27e3872bf7ba6690fd25b61e6323ca272a44fff3f94.glb","7f99758800fc7d7dc304320a7d8b53cb0d09c3e2dc5b85084005894aa7adfe3c.js","9eed8f2520fae4b02052fa66264aec8b8ca285bc004267a5a13f6576d40c22ed.glb"],"blueprint_path":"blueprint.json"}