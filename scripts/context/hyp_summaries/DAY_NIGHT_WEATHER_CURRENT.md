# DAY_NIGHT_WEATHER_CURRENT.hyp

## Metadata
- **Author**: ~/drdoge.eth
- **Channel**: #üé®‚îÇshowcase
- **Date**: 2025-04-21
- **Size**: 4,496,540 bytes

## Blueprint
- **Name**: DAY/NIGHT/WEATHER
- **Version**: 537
- **Model**: `asset://acdf8fa51fdb8b4e726b2fd502dce23a3a6010d37aabbe9209cd0958ed92fba5.glb`
- **Script**: `asset://52f9fe83b66eb1fed1b0273f212cd990e1d2d0a4d9e472c1fbdc970f0bd7164a.js`

## Props
- `sky`: texture ‚Üí `asset://ec7fdf804dcca54904e4ebd480c1b574a040439bc2543010d640f303f35126ee.jpg`
- `hdr`: hdr ‚Üí `asset://3bd5de5a2bf09b581b4be89763bf3261bf65a9c6aee8a3ba99d960c405857b7e.hdr`
- `hour`: int = `1`
- `period`: str = `pm`
- `hour2`: int = `9`
- `intensity`: int = `5`
- `autoRotate`: bool = `False`
- `cycleSpeed`: int = `1`
- `timeOfDay`: float = `5.4`
- `autoTime`: bool = `False`
- `manualTime`: int = `0`
- `useRealTime`: bool = `True`
- `tod_autoRotate`: bool = `True`
- `tod_timeOfDay`: int = `12`
- `tod_intensity`: int = `3`
- `sky_texture`: texture ‚Üí `asset://39d25b8b27606488c25e0a5f3d94cce7befa80b8e4599961ac94622a41550cd3.jpg`
- `sky_hdr`: hdr ‚Üí `asset://6861489f983cdc0c22435b781a3487171bd25f25f9cc52c46ac402d48e08249e.hdr`
- `daynight_timeOfDay`: float = `18.4`
- `daynight_intensity`: int = `1`
- `daynight_autoRotate`: bool = `True`
- `daynight_timeofday`: int = `12`
- `sun_timeOfDay`: float = `23.4`
- `sun_intensity`: int = `1`
- `sun_autoRotate`: bool = `True`
- `fogNear`: int = `0`
- `fogFar`: int = `1000`
- `fogColor`: str = `#D4B59F`
- `fogDensity`: float = `0.2`
- `sunColor`: str = `#BDC9E5`
- `fogHeight`: int = `0`
- `fogFalloff`: int = `1`
- `sunTextureScale`: int = `1`
- `skyRotationEnabled`: bool = `True`
- `sunTexture`: NoneType = `None`
- `fogPositionX`: int = `0`
- `fogPositionY`: int = `-15`
- `fogPositionZ`: int = `0`
- `fogAnimation`: bool = `False`
- `fogAnimationSpeed`: int = `2`
- `randomWeather`: bool = `False`
- `weatherType`: str = `clear`
- `particleDensity`: int = `25`
- `rainTexture`: texture ‚Üí `asset://4e5f177b7717d291464f01538756eb2f471961b09b39ea82ea72447210af7110.png`
- `dustTexture`: texture ‚Üí `asset://6827a0a32a293ec9570fb98d63963b8dd6e6aaba9e1096afad932e93a378bea9.png`
- `radstormTexture`: texture ‚Üí `asset://b68627734d08aab3eaf3f94718521553628c75aace1de6c74de28501c1a4c147.png`
- `fogParticleTexture`: texture ‚Üí `asset://eae1d92c205a2654254281d470ee70cce86cf4e8e849db29e4d5edff0f67c695.png`
- `ashTexture`: texture ‚Üí `asset://1e8ab968178e507824ab28353c0ffffa918ae3adbcf89513d3db50a17b7bc8a2.png`
- `cloudTexture`: texture ‚Üí `asset://3cb3237277e41f89b8c7a3be9a2106606a6fe229358dd7b78bfb5ca905545aca.png`
- `lightningTexture`: texture ‚Üí `asset://fe6d473393d3b9350c7a654b7cb5fbd343766b5b5b11d3e4aba476832d4a6d3f.png`
- `thunderSound`: audio ‚Üí `asset://b8002fbc9f6429e5daefbd05921826260682812f2969d4551f38eccc89badebf.mp3`
- `rainSound`: audio ‚Üí `asset://61c92c476b9ffaa6f25191b2974d7a4459163c0e01a69aac2a3e87ec34166c39.mp3`
- `defaultParticleTexture`: texture ‚Üí `asset://a8c05800698cd502c3416a1f2335292544d52b3c8624c3c829a534c52b364860.png`
- `lightningHeight`: int = `1000`
- `lightningStartHeight`: int = `50`
- `rainColor`: str = `#6495ED`
- `stormRainColor`: str = `#4682B4`
- `lightningColor`: str = `#f8f8ff`
- `lightningEmissive`: int = `40`

## Assets
- `[model]` acdf8fa51fdb8b4e726b2fd502dce23a3a6010d37aabbe9209cd0958ed92fba5.glb (12,728 bytes)
- `[script]` 52f9fe83b66eb1fed1b0273f212cd990e1d2d0a4d9e472c1fbdc970f0bd7164a.js (60,432 bytes)
- `[texture]` a89b198e301f183c89c7d92e9eb29d93cbff452404bb63d994a815b767e4195e.png (147 bytes)
- `[texture]` ec7fdf804dcca54904e4ebd480c1b574a040439bc2543010d640f303f35126ee.jpg (321,725 bytes)
- `[hdr]` 3bd5de5a2bf09b581b4be89763bf3261bf65a9c6aee8a3ba99d960c405857b7e.hdr (284,529 bytes)
- `[texture]` 39d25b8b27606488c25e0a5f3d94cce7befa80b8e4599961ac94622a41550cd3.jpg (37,739 bytes)
- `[hdr]` 6861489f983cdc0c22435b781a3487171bd25f25f9cc52c46ac402d48e08249e.hdr (1,745,132 bytes)
- `[texture]` 4e5f177b7717d291464f01538756eb2f471961b09b39ea82ea72447210af7110.png (33,145 bytes)
- `[texture]` 6827a0a32a293ec9570fb98d63963b8dd6e6aaba9e1096afad932e93a378bea9.png (47,313 bytes)
- `[texture]` b68627734d08aab3eaf3f94718521553628c75aace1de6c74de28501c1a4c147.png (100,114 bytes)
- `[texture]` eae1d92c205a2654254281d470ee70cce86cf4e8e849db29e4d5edff0f67c695.png (90,424 bytes)
- `[texture]` 1e8ab968178e507824ab28353c0ffffa918ae3adbcf89513d3db50a17b7bc8a2.png (62,216 bytes)
- `[texture]` 3cb3237277e41f89b8c7a3be9a2106606a6fe229358dd7b78bfb5ca905545aca.png (19,663 bytes)
- `[texture]` fe6d473393d3b9350c7a654b7cb5fbd343766b5b5b11d3e4aba476832d4a6d3f.png (46,347 bytes)
- `[audio]` b8002fbc9f6429e5daefbd05921826260682812f2969d4551f38eccc89badebf.mp3 (629,760 bytes)
- `[audio]` 61c92c476b9ffaa6f25191b2974d7a4459163c0e01a69aac2a3e87ec34166c39.mp3 (957,126 bytes)
- `[texture]` a8c05800698cd502c3416a1f2335292544d52b3c8624c3c829a534c52b364860.png (42,254 bytes)

## Script Analysis
**App Methods**: `app.add()`, `app.configure()`, `app.create()`, `app.on()`, `app.raycast()`, `app.remove()`
**Events Listened**: `update`
**Nodes Created**: `audio`, `particles`, `sky`, `ui`, `uitext`, `uiview`

## Keywords (for Discord search)
a8f0a8, above, active, activeWeatherSystems, actual, addErr, added, adding, additive, adjust, after, again, alignItems, alpha, alphaOverLife, already, angle, animation, another, anymore

## Script Source
```javascript
let lastConfig = null
let sky = null
const SPEED = 1.6 // Slower speed for more gradual movement
let daysPassed = 0
let previousHour = 0
let cycleStartTime = Date.now()
let fogParticleSystem = null

// Weather system variables
const WEATHER_TYPES = {
	CLEAR: 'clear',
	CLOUDY: 'cloudy',
	RAIN: 'rain',
	STORM: 'storm',
	RADSTORM: 'radstorm',
	DUSTSTORM: 'duststorm',
	FOGGY: 'foggy',
	NUCLEAR: 'nuclear',
	// Combined weather types
	RAINY_CLOUDS: 'rainyclouds',
	THUNDER_STORM: 'thunderstorm',
	RAD_CLOUDS: 'radclouds',
	DUST_CLOUDS: 'dustclouds',
	WASTELAND_STORM: 'wastelandstorm'
}

// Particle systems for different weather types
let activeWeatherSystems = {}
let currentWeather = WEATHER_TYPES.CLEAR
let weatherTransitioning = false
let weatherTransitionTime = 0
let weatherTimer = 0
let weatherDuration = 0
let randomWeatherEnabled = false

// Create UI with Pip-Boy style
const ui = app.create('ui', {
	lit: true,
	doubleside: true,
	width: 170,
	height: 80,
	backgroundColor: 'rgba(0, 50, 0, 0)', // Made fully transparent
	borderRadius: 10,
	padding: 10,
	display: 'flex'
})
ui.position.set(0, 3, -1) // Lowered Y from 4 to 2.5
ui.billboard = 'y'
app.add(ui)

// Create time display view
const timeView = app.create('uiview', {
	display: 'flex',
	flexDirection: 'column',
	justifyContent: 'center',
	alignItems: 'center',
	width: 150,
	height: 70,
	padding: 4
})

// Time of day display
const timeText = app.create('uitext', {
	padding: 5,
	textAlign: 'center',
	value: 'Time: 00:00',
	color: '#00ff00', // Keep Pip-Boy green
	textShadow: '0 0 10px #00ff00', // Add glow effect
	fontSize: 18,
	backgroundColor: 'rgba(0, 0, 0, 0)' // Fully transparent background
})

// Days passed display
const daysText = app.create('uitext', {
	padding: 5,
	textAlign: 'center',
	value: 'Days Passed: 0',
	color: '#00ff00', // Keep Pip-Boy green
	textShadow: '0 0 10px #00ff00', // Add glow effect
	fontSize: 18,
	backgroundColor: 'rgba(0, 0, 0, 0)' // Fully transparent background
})

// Add UI elements
ui.add(timeView)
timeView.add(timeText)
timeView.add(daysText)

// Add this function to calculate days based on elapsed time
function updateDaysPassed() {
	const currentTime = Date.now()
	const elapsedMs = currentTime - cycleStartTime
	const dayLengthMs = (24 / SPEED) * 1000 // Convert speed to real milliseconds for a full day

	// Calculate complete days
	const completeDays = Math.floor(elapsedMs / dayLengthMs)

	if (completeDays > daysPassed) {
		daysPassed = completeDays
	}
}

// Modify the update handler for UI
app.on('update', delta => {
	if (app.config.autoRotate) {
		updateSunPosition(delta)
	}
	
	// Update fog animation if enabled
	if (app.config.fogAnimation) {
		updateFogAnimation(delta)
	}
	
	// Update weather system
	if (randomWeatherEnabled) {
		updateWeatherSystem(delta, app.config)
	}

	// Update UI display
	// Update days passed based on real time
	if (app.config.autoRotate) {
		updateDaysPassed()
	}

	// Update time display
	const hour24 = app.config.timeOfDay || 0  // Changed from 12 to 0
	const hours = Math.floor(hour24)
	const minutes = Math.floor((hour24 % 1) * 60)

	// Format time in Pip-Boy style
	const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`
	timeText.value = `Time: ${timeString}`
	daysText.value = `Days in ‚ä¨‚üí‚åñ‚ãâ‚éç: ${daysPassed}`

	// Add rotation update to keep UI facing camera
	if (ui && app.camera) {
		const angle = Math.atan2(
			app.camera.position.x - ui.position.x,
			app.camera.position.z - ui.position.z
		)
		ui.rotation.y = angle
	}
})

function calculateSolarPosition(hour24) {
	// Convert hour to decimal time (0-1), using modulo for smooth wrapping
	const time = (hour24 % 24) / 24

	// Convert time to solar angle (-œÄ to œÄ)
	const solarAngle = (time * 2 * Math.PI) - Math.PI

	// Set latitude for Mojave Desert (approximately 35¬∞N) in radians
	const latitude = 35 * (Math.PI / 180)

	// Calculate solar declination for Mojave Desert
	// Using typical summer declination for New Vegas setting
	const declination = -10 * (Math.PI / 180)  // Adjusted for Mojave's characteristic angle

	// Calculate solar elevation (height above horizon)
	const elevation = Math.asin(
		Math.sin(latitude) * Math.sin(declination) +
		Math.cos(latitude) * Math.cos(declination) * Math.cos(solarAngle)
	)

	// Calculate solar azimuth with Mojave's characteristic east-west bias
	const azimuth = Math.atan2(
		-Math.cos(declination) * Math.sin(solarAngle),
		Math.cos(latitude) * Math.sin(declination) -
		Math.sin(latitude) * Math.cos(declination) * Math.cos(solarAngle)
	) + (5 * (Math.PI / 180))  // Slight offset for Mojave's characteristic angle

	// Convert spherical coordinates (azimuth, elevation) to Cartesian (x,y,z)
	const coselevation = Math.cos(elevation)
	// Maintain the correct orientation with Mojave characteristics
	const x = -Math.cos(azimuth) * coselevation
	const y = Math.sin(elevation) * 0.85  // Slightly lower height to match Mojave
	const z = Math.sin(azimuth) * coselevation

	return new Vector3(x, y, z)
}

function calculateSunIntensity(hour24) {
	// Normalize hour to 0-24 range
	const normalizedHour = hour24 % 24

	// Define key times of day
	const DAWN_START = 5    // Dawn begins
	const SUNRISE = 6       // Sunrise
	const NOON = 12         // Peak brightness
	const SUNSET = 18       // Sunset
	const DUSK_END = 19     // Dusk ends

	// Calculate base intensity based on time of day
	let intensity
	if (normalizedHour < DAWN_START) {
		// Night (midnight to dawn start)
		intensity = 0.15 // Slightly brighter night
	} else if (normalizedHour < SUNRISE) {
		// Dawn (increasing brightness)
		const progress = (normalizedHour - DAWN_START) / (SUNRISE - DAWN_START)
		intensity = 0.15 + (0.85 * progress) // More dramatic dawn
	} else if (normalizedHour < NOON) {
		// Morning (increasing to peak)
		const progress = (normalizedHour - SUNRISE) / (NOON - SUNRISE)
		intensity = 1.0 + (0.8 * progress) // Higher peak brightness
	} else if (normalizedHour < SUNSET) {
		// Afternoon (decreasing from peak)
		const progress = (normalizedHour - NOON) / (SUNSET - NOON)
		intensity = 1.8 - (0.8 * progress) // Gradual decrease from peak
	} else if (normalizedHour < DUSK_END) {
		// Dusk (decreasing to night)
		const progress = (normalizedHour - SUNSET) / (DUSK_END - SUNSET)
		intensity = 1.0 - (0.85 * progress) // More dramatic dusk
	} else {
		// Night (dusk end to midnight)
		intensity = 0.15 // Slightly brighter night
	}

	return intensity
}

function castRayForFog(origin, direction, maxDistance) {
	const hit = app.raycast(origin, direction, maxDistance)
	return hit ? hit.distance : maxDistance
}

function updateFogBasedOnEnvironment(camera, sky) {
	if (!camera || !camera.position) return { min: 100, avg: 100 }

	// Cast rays in a sphere pattern for better environment detection
	const directions = [
		new Vector3(1, 0, 0),    // Right
		new Vector3(-1, 0, 0),   // Left
		new Vector3(0, 1, 0.5),  // Up-forward
		new Vector3(0, -1, 0.5), // Down-forward
		new Vector3(0, 0, 1),    // Forward
		new Vector3(0, 0, -1),   // Back
	]

	let minDistance = 100 // Default distance if no hits
	let avgDistance = 0
	let samples = 0

	try {
		for (const dir of directions) {
			const distance = castRayForFog(camera.position, dir, 100)
			minDistance = Math.min(minDistance, distance)
			avgDistance += distance
			samples++
		}
	} catch (e) {
		console.warn('Ray casting failed:', e)
		return { min: 100, avg: 100 }
	}

	return {
		min: minDistance,
		avg: samples > 0 ? avgDistance / samples : 100
	}
}

function updateSunPosition(delta) {
	if (!sky) return

	let hour24 = app.config.timeOfDay || 0

	if (app.config.autoRotate) {
		// Increment time smoothly and wrap using modulo
		let newTime = (hour24 + SPEED * delta) % 24
		previousHour = newTime

		// Update time of day with 1 decimal place
		app.config.timeOfDay = parseFloat(newTime.toFixed(1))

		// Rotate sky background with day cycle
		if (sky.bg) {
			// Calculate rotation based on time of day (complete 360¬∞

// ... truncated ...
```

---
*Extracted from DAY_NIGHT_WEATHER_CURRENT.hyp. Attachment ID: 1364018271384244294*